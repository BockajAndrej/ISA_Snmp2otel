receivers:
  otlp:
    protocols:
      http:
        endpoint: 0.0.0.0:4318

processors:
  filter/my_app_metrics:
    metrics:
      # Ponechá LEN tie metriky, kde atribút zdroja 'service.name'
      # presne zodpovedá hodnote 'moja-specialna-aplikacia'.
      include:
        match_type: strict
        resource_attributes:
          - key: service.name
            value: "ServerName"

  # Voliteľné: Vždy je dobré mať nejaký batching (dávkovanie)
  batch:

# 2. DEFINUJTE EXPORTÉRY
exporters:
  # Exportér pre vypísanie filtrovaných dát do terminálu (vysoká úroveň detailov)
  logging/filtered:
    loglevel: debug

  # Exportér pre ostatné (nefiltrované) dáta, ktoré nechcete vypisovať do terminálu.
  # Toto by bol váš "normálny" exportér do skutočného backendu (napr. Prometheus, OTLP backend, atď.)
  # Ak nechcete ostatné dáta nikam posielať, tento exportér môžete vynechať.
  # logging/default:
  #   loglevel: info


service:
  pipelines:
    metrics:
      receivers: [otlp]
      processors: [batch] # Dátá prechádzajú cez batch a idú ďalej
      # Poznámka: ŽIADNY exportér tu. Metriky sa rozdelia v konektoroch (pozri nižšie).

  # 3. ROZDELENIE DÁT POMOCOU KONEKTOROV (Connectors)
  # Konektor slúži na presmerovanie telemetrie medzi pipelineami.
  # Tu ho použijeme na presmerovanie všetkých metrík do dvoch nových pipelineov.
  extensions:
    health_check:

  connectors:
    pipeline:

  pipelines:
    # 4. PRVÝ PIPELINE: Filtrovanie a výpis do terminálu
    metrics/my_app_debug:
      receivers: [otlp] # Prijíma dáta priamo z otlp receiveru
      processors: [filter/my_app_metrics, batch] # Filtruje LEN vašu appku
      exporters: [logging/filtered] # Vypíše ju do terminálu

    # 5. DRUHÝ PIPELINE: Ostatné dáta (všetko, čo nebolo zobrazené) do normálneho backendu
    metrics/default:
      receivers: [otlp] # Prijíma dáta priamo z otlp receiveru
      processors: [batch] # Voliteľné procesory
      # exportér, ktorý by poslal dáta do normálneho úložiska,
      # napr. [prometheus, otlp/backend]
      exporters: [logging] # Použijeme len logging pre príklad (ale s iným názvom, ak by ste chceli aj toto vidieť)